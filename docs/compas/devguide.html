<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Developer Guide &#8212; COMPAS 1.16.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Changelog" href="changelog.html" />
    <link rel="prev" title="Extension points" href="plugins.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="developer-guide">
<h1>Developer Guide</h1>
<p>This guide is intended for people who want to contribute
to the code, documentation, and test coverage of the core COMPAS packages:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://compas.dev/compas/latest/api/compas.html#module-compas" title="(in COMPAS v1.17)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compas</span></code></a></p></li>
<li><p><a class="reference external" href="https://compas.dev/compas/latest/api/compas_blender.html#module-compas_blender" title="(in COMPAS v1.17)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compas_blender</span></code></a></p></li>
<li><p><a class="reference external" href="https://compas.dev/compas/latest/api/compas_ghpython.html#module-compas_ghpython" title="(in COMPAS v1.17)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compas_ghpython</span></code></a></p></li>
<li><p><a class="reference external" href="https://compas.dev/compas/latest/api/compas_plotters.html#module-compas_plotters" title="(in COMPAS v1.17)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compas_plotters</span></code></a></p></li>
<li><p><a class="reference external" href="https://compas.dev/compas/latest/api/compas_rhino.html#module-compas_rhino" title="(in COMPAS v1.17)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compas_rhino</span></code></a></p></li>
</ul>
<p>Note, however, that the general procedure is applicable to all COMPAS package development.</p>
<section id="setup-installation">
<h2>Setup/Installation</h2>
<p>To set up a developer environment</p>
<ol class="arabic">
<li><p>Fork <a class="reference external" href="https://github.com/compas-dev/compas">the repository</a> and clone the fork.</p></li>
<li><p>Create a virtual environment using your tool of choice (e.g. <cite>virtualenv</cite>, <cite>conda</cite>, etc).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>compas-dev<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.8<span class="w"> </span>cython<span class="w"> </span>--yes
conda<span class="w"> </span>activate<span class="w"> </span>compas-dev
</pre></div>
</div>
</li>
<li><p>Install development dependencies:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>path/to/compas
pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements-dev.txt
</pre></div>
</div>
</li>
<li><p>Make sure all tests pass and the code is free of lint:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>invoke<span class="w"> </span>lint
invoke<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
</li>
<li><p>Create a branch for your contributions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">branch</span> <span class="n">title</span><span class="o">-</span><span class="n">proposed</span><span class="o">-</span><span class="n">changes</span>
<span class="n">git</span> <span class="n">checkout</span> <span class="n">title</span><span class="o">-</span><span class="n">proposed</span><span class="o">-</span><span class="n">changes</span>
</pre></div>
</div>
</li>
<li><p>Start making changes!</p></li>
</ol>
</section>
<section id="submitting-a-pr">
<h2>Submitting a PR</h2>
<p>Once you are done making changes, you have to submit your contribution through a pull request (PR).
The procedure for submitting a PR is the following.</p>
<ol class="arabic">
<li><p>Make sure all tests still pass, the code is free of lint, and the docstrings compile correctly:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>invoke<span class="w"> </span>lint
invoke<span class="w"> </span><span class="nb">test</span>
invoke<span class="w"> </span>docs
</pre></div>
</div>
</li>
<li><p>Add yourself to <code class="docutils literal notranslate"><span class="pre">AUTHORS.md</span></code>.</p></li>
<li><p>Summarize the changes you made in <code class="docutils literal notranslate"><span class="pre">CHANGELOG.md</span></code>.</p></li>
<li><p>Commit your changes and push your branch to GitHub.</p></li>
<li><p>Create a <a class="reference external" href="https://help.github.com/articles/about-pull-requests/">pull request</a>.</p></li>
</ol>
</section>
<section id="style-guide">
<h2>Style guide</h2>
<p>Please run <cite>black -l 180 &lt;path_to_source_file&gt;</cite> to auto-format your code.</p>
<p>The command <code class="docutils literal notranslate"><span class="pre">invoke</span> <span class="pre">lint</span></code> runs the entire codebase through <code class="docutils literal notranslate"><span class="pre">flake8</span></code>.
As described in the <a class="reference external" href="https://flake8.pycqa.org/en/latest/manpage.html">docs</a>,
<code class="docutils literal notranslate"><span class="pre">flake8</span></code> includes lint checks provided by the PyFlakes project,
PEP-0008 inspired style checks provided by the PyCodeStyle project,
and McCabe complexity checking provided by the McCabe project.</p>
<p>The list of potential error codes issued by <code class="docutils literal notranslate"><span class="pre">flake8</span></code> are available here:
<a class="reference external" href="https://flake8.pycqa.org/en/latest/user/error-codes.html">https://flake8.pycqa.org/en/latest/user/error-codes.html</a></p>
<p>The PEP-0008 style guide is available here:
<a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">https://www.python.org/dev/peps/pep-0008/</a></p>
<p>Note that the maximum line length is set to 180 rather 79 in the <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> of the repo.</p>
</section>
<section id="naming-conventions">
<h2>Naming conventions</h2>
<p>We (intend to) use the following naming conventions.</p>
<ol class="arabic simple">
<li><p>variables, functions, methods, attributes use “snake_case”:
they are written in lowercase and spaces between words are replaced by underscores.</p></li>
<li><p>class names use (Upper) “CamelCase”:
The are written in lowercase, with the first letter of each word capitalized
and spaces between words removed.</p></li>
<li><p>module or package level variables are in uppercase
and with spaces between words replaced by underscores.</p></li>
</ol>
</section>
<section id="quotes">
<h2>Quotes</h2>
<p>Ideally, we would use the following conventions for quotes.</p>
<ol class="arabic simple">
<li><p>Double quotation marks for multiline statements and docstrings.
For example, <code class="docutils literal notranslate"><span class="pre">&quot;&quot;&quot;Calculate</span> <span class="pre">the</span> <span class="pre">sum</span> <span class="pre">of</span> <span class="pre">two</span> <span class="pre">numbers.&quot;&quot;&quot;</span></code></p></li>
<li><p>Single quotation marks for strings that are used “as variables”.
For example, <code class="docutils literal notranslate"><span class="pre">config['param']</span> <span class="pre">=</span> <span class="pre">1</span></code>.</p></li>
<li><p>Double quotation marks for strings that are meant to be used as text.
For examples, <code class="docutils literal notranslate"><span class="pre">message</span> <span class="pre">=</span> <span class="pre">&quot;Select</span> <span class="pre">one</span> <span class="pre">or</span> <span class="pre">more</span> <span class="pre">points.&quot;</span></code></p></li>
</ol>
</section>
<section id="documentation">
<h2>Documentation</h2>
<p>The documentation of COMPAS is generated with Sphinx.
This means that code docstrings and general documentation pages
have to be written in RestructuredText.</p>
<p>Each function, method, and class should have a docstring describing its behaviour.
We use <code class="docutils literal notranslate"><span class="pre">sphinx.ext.napoleon</span></code> to allow for human-readable docstrings,
and prefer Numpy-style docstring formatting rules.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/extensions/napoleon.html">https://www.sphinx-doc.org/en/master/usage/extensions/napoleon.html</a></p></li>
<li><p><a class="reference external" href="https://numpydoc.readthedocs.io/en/latest/format.html">https://numpydoc.readthedocs.io/en/latest/format.html</a></p></li>
</ul>
<p>To include a new function or class in the documentation,
it should be added to the API docstring in <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> of the main package it belongs to.</p>
<p>For example, if you add a function somewhere in the geometry package,
make sure to include it in the docstring of <code class="docutils literal notranslate"><span class="pre">compas.geometry.__init__.py</span></code>.</p>
</section>
<section id="type-hints">
<h2>Type hints</h2>
<p>Type hints should be added to stub files at the public API level
of the main packages (see <a class="reference internal" href="#code-structure"><span class="std std-ref">Code structure</span></a>).
This allows the type hints to be written using Python 3 style
annotations while maintaining compatibility with Python 2.7 for Rhino/GH.</p>
<p>For example, the type hints for <code class="docutils literal notranslate"><span class="pre">compas.datastructures</span></code> should be defined in
<code class="docutils literal notranslate"><span class="pre">compas.datastructures.__init__.pyi</span></code>.</p>
</section>
<section id="code-structure">
<span id="id1"></span><h2>Code structure</h2>
<p>Each of the core packages is divided into subpackages that group functionality into logical components.
For example, <a class="reference external" href="https://compas.dev/compas/latest/api/compas.html#module-compas" title="(in COMPAS v1.17)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compas</span></code></a> is divided into:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://compas.dev/compas/latest/api/compas.datastructures.html#module-compas.datastructures" title="(in COMPAS v1.17)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compas.datastructures</span></code></a></p></li>
<li><p><a class="reference external" href="https://compas.dev/compas/latest/api/compas.files.html#module-compas.files" title="(in COMPAS v1.17)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compas.files</span></code></a></p></li>
<li><p><a class="reference external" href="https://compas.dev/compas/latest/api/compas.geometry.html#module-compas.geometry" title="(in COMPAS v1.17)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compas.geometry</span></code></a></p></li>
<li><p><a class="reference external" href="https://compas.dev/compas/latest/api/compas.numerical.html#module-compas.numerical" title="(in COMPAS v1.17)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compas.numerical</span></code></a></p></li>
<li><p><a class="reference external" href="https://compas.dev/compas/latest/api/compas.robots.html#module-compas.robots" title="(in COMPAS v1.17)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compas.robots</span></code></a></p></li>
<li><p><a class="reference external" href="https://compas.dev/compas/latest/api/compas.rpc.html#module-compas.rpc" title="(in COMPAS v1.17)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compas.rpc</span></code></a></p></li>
<li><p><a class="reference external" href="https://compas.dev/compas/latest/api/compas.topology.html#module-compas.topology" title="(in COMPAS v1.17)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compas.topology</span></code></a></p></li>
<li><p><a class="reference external" href="https://compas.dev/compas/latest/api/compas.utilities.html#module-compas.utilities" title="(in COMPAS v1.17)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compas.utilities</span></code></a></p></li>
</ul>
<p>The API of each subpackage is documented in the docstring of its <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file using basic RestructuredText.
From outside of these packages, functionality should be imported directly from the subpackage level,
regardless of the code structure underneath.</p>
<p>For example, in some <code class="docutils literal notranslate"><span class="pre">script.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">compas.datastructures</span> <span class="kn">import</span> <span class="n">Mesh</span>
<span class="kn">from</span> <span class="nn">compas.datastructures</span> <span class="kn">import</span> <span class="n">Network</span>

<span class="kn">from</span> <span class="nn">compas.geometry</span> <span class="kn">import</span> <span class="n">add_vectors</span>
<span class="kn">from</span> <span class="nn">compas.geometry</span> <span class="kn">import</span> <span class="n">oriented_bounding_box_numpy</span>
<span class="kn">from</span> <span class="nn">compas.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span>
<span class="kn">from</span> <span class="nn">compas.geometry</span> <span class="kn">import</span> <span class="n">Transformation</span>

<span class="kn">from</span> <span class="nn">compas.numerical</span> <span class="kn">import</span> <span class="n">pca_numpy</span>
<span class="kn">from</span> <span class="nn">compas.numerical</span> <span class="kn">import</span> <span class="n">fd_numpy</span>
</pre></div>
</div>
<p>To allow the public API of the modules and packages contained in a subpackage to reach the subpackage level,
each module should declare the classes, functions and variables of its public API in the module’s <code class="docutils literal notranslate"><span class="pre">__all__</span></code> variable.
Per package, the APIs of the contained module are collected in the <code class="docutils literal notranslate"><span class="pre">__all__</span></code> variable of the package (in the <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</section>
<section id="dependencies">
<h2>Dependencies</h2>
<p>More info coming soon…</p>
</section>
<section id="testing">
<h2>Testing</h2>
<p>Although we still have a significant backlog of existing functionality
not yet covered by unit tests, at least all newly added functionality
should have a corresponding test.</p>
<p>We use <code class="docutils literal notranslate"><span class="pre">pytest</span></code> as a testing framework.
The tests are in the <code class="docutils literal notranslate"><span class="pre">tests</span></code> folder at the root of the repo.</p>
<p>More info coming soon…</p>
</section>
<section id="grasshopper-components">
<h2>Grasshopper components</h2>
<p>Grasshopper user objects need to be built using <a class="reference external" href="https://github.com/compas-dev/compas-actions.ghpython_components">COMPAS Github Action componentizer</a>.</p>
<ol class="arabic">
<li><p>Apply your changes to the component source code (<code class="docutils literal notranslate"><span class="pre">src/compas_ghpython/components</span></code>).</p></li>
<li><p>Rebuild them:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>invoke<span class="w"> </span>build-ghuser-components
</pre></div>
</div>
</li>
<li><p>Install them on Rhino/Grasshopper as usual:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>compas_rhino.install
</pre></div>
</div>
</li>
</ol>
<p>The install step does not copy them, but creates a symlink to the location in which they are built,
so after the first installation, it is usually not required to reinstall them, only rebuild them (unless a new component is added).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step requires IronPython version 2.7 to be available on the system.  The default behavior is to run the command
<code class="docutils literal notranslate"><span class="pre">ipy</span></code>.  If this command is not available or is the wrong version, the optional <code class="docutils literal notranslate"><span class="pre">ironpython</span></code> argument will replace it, eg
<code class="docutils literal notranslate"><span class="pre">invoke</span> <span class="pre">build-ghuser-components</span> <span class="pre">--ironpython=&quot;mono</span> <span class="pre">path/to/ipy.exe&quot;</span></code>.</p>
</div>
</section>
<section id="plugins">
<span id="id2"></span><h2>Plugins</h2>
<p>COMPAS has an extensible architecture based on plugins that allows to
customize and extend the functionality of the core framework.</p>
<p>For a plugin to work, there needs to exist a counterpart to be connected to.
This means there are two components involved:</p>
<ul class="simple">
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">compas.plugins.pluggable()</span></code> interface: the <em>extension point</em> that COMPAS defines
as the counterpart for plugins to connect to.</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">compas.plugins.plugin()</span></code> implementation: a <em>concrete implementation</em> of the
<code class="docutils literal notranslate"><span class="pre">pluggable</span></code> interface.</p></li>
</ul>
<p>Both of these components are declared using decorators:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pluggable</span>
<span class="k">def</span> <span class="nf">do_hard_stuff</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@plugin</span><span class="p">(</span><span class="n">pluggable_name</span><span class="o">=</span><span class="s1">&#39;do_hard_stuff&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_hard_stuff_numpy</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="c1"># NOTE: Here use the power of numpy to do hard stuff very fast</span>
    <span class="c1"># ..</span>
</pre></div>
</div>
<p>Once these parts are implemented, the program could simply
call the function <code class="docutils literal notranslate"><span class="pre">do_hard_stuff</span></code> and the appropriate plugin
implementation using <code class="docutils literal notranslate"><span class="pre">numpy</span></code> would be called automatically.</p>
<section id="why-are-plugins-important">
<h3>Why are plugins important?</h3>
<p>The example above is just a single code block, but the power of plugins comes
from the ability to split those two parts -the <code class="xref py py-meth docutils literal notranslate"><span class="pre">compas.plugins.pluggable()</span></code>
and the <code class="xref py py-meth docutils literal notranslate"><span class="pre">compas.plugins.plugin()</span></code>- into completely different files, folders
or even entire projects and still work the same way.</p>
<p>Additionally, COMPAS is able to pick the most suitable plugin implementation
for its current execution context. For instance, one could have two implementations
of the same <code class="xref py py-meth docutils literal notranslate"><span class="pre">compas.plugins.pluggable()</span></code> definition, one using <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and
another one using <em>Rhino SDK</em> and have the correct one automatically selected
based on where your script is executing.</p>
</section>
<section id="how-to-make-plugins-discoverable">
<h3>How to make plugins discoverable?</h3>
<p>COMPAS plugin discovery is based on naming conventions. This is mainly due to
the need to support IronPython inside Rhino, which lacks <code class="docutils literal notranslate"><span class="pre">setuptools</span></code>
infrastructure. For more details, check
<a class="reference external" href="https://packaging.python.org/guides/creating-and-discovering-plugins/#using-naming-convention">these python guidelines</a>.</p>
<p>A COMPAS plugin needs to fulfill two conditions:</p>
<ul class="simple">
<li><p><strong>Name</strong>: The package name should be prefixed with <code class="docutils literal notranslate"><span class="pre">compas</span></code>, eg. <code class="docutils literal notranslate"><span class="pre">compas_cgal</span></code>.</p></li>
<li><p><strong>Metadata</strong>: The package should define a bit of metadata listing the modules that contain plugins.
This is done declaring a variable called <code class="docutils literal notranslate"><span class="pre">__all_plugins__</span></code>,
eg. <code class="docutils literal notranslate"><span class="pre">__all_plugins__</span> <span class="pre">=</span> <span class="pre">['compas_cgal.booleans']</span></code>.</p></li>
</ul>
<p>COMPAS automatically discovers plugins searching over all available packages in the system,
and picks up those prefixed with the <code class="docutils literal notranslate"><span class="pre">compas</span></code> word.
All packages are included in the search: packages installed with <code class="docutils literal notranslate"><span class="pre">pip</span></code>, packages made
available through the <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> / <code class="docutils literal notranslate"><span class="pre">IRONPYTHONPATH</span></code>, local packages, etc.</p>
<p>Once a package is found, the metadata in <code class="docutils literal notranslate"><span class="pre">__all_plugins__</span></code> is read and all modules
listed are analyzed to look for functions decorated with the <code class="xref py py-meth docutils literal notranslate"><span class="pre">compas.plugins.plugin()</span></code>
decorator.</p>
</section>
<section id="two-kinds-of-extension-points">
<h3>Two kinds of extension points</h3>
<p>An extension point, or <em>pluggable</em> interface can be declared as being one of two types
based on how they select which implementation to pick if there are multiple available.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">selector='first_match'</span></code>: this type of extension point will pick the first plugin
implementation that satisfies the requirements.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">selector='collect_all'</span></code>: extension points defined with this selector will instead
collect all plugin implementations and execute them all, collecting the return
values into a list. An example of this is the Rhino install extension
point: <code class="xref py py-meth docutils literal notranslate"><span class="pre">compas_rhino.install.installable_rhino_packages()</span></code>.</p></li>
</ul>
</section>
<section id="a-complete-example">
<h3>A complete example</h3>
<p>Let’s explore a complete example to gain a better understanding.</p>
<section id="extension-point">
<h4>Extension point</h4>
<p>For the sake of example, we are going to assume that <code class="docutils literal notranslate"><span class="pre">compas</span></code> core defines
the following <code class="xref py py-meth docutils literal notranslate"><span class="pre">compas.plugins.pluggable()</span></code> interface in</p>
<p><strong>compas/geometry/booleans/__init__.py</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pluggable</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s1">&#39;booleans&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">boolean_union_mesh_mesh</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="plugin">
<h4>Plugin</h4>
<p>Now let’s write a plugin that implements this interface:</p>
<p><strong>compas_plugin_sample/__init__.py</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">__all_plugins__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;compas_plugin_sample.boolean_trimesh&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>compas_plugin_sample/boolean_trimesh.py</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">trimesh</span>

<span class="nd">@plugin</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s1">&#39;booleans&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;trimesh&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">boolean_union_mesh_mesh</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="n">va</span><span class="p">,</span> <span class="n">fa</span> <span class="o">=</span> <span class="n">A</span>
    <span class="n">at</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="n">fa</span><span class="p">)</span>

    <span class="n">vb</span><span class="p">,</span> <span class="n">fb</span> <span class="o">=</span> <span class="n">B</span>
    <span class="n">bt</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="n">vb</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="n">fb</span><span class="p">)</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">bt</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;scad&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">faces</span>
</pre></div>
</div>
<p>Voilà! We have a trimesh-based boolean union plugin!</p>
</section>
</section>
<section id="advanced-options">
<h3>Advanced options</h3>
<p>There are a few additional options that plugins can use:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">requires</span></code>: List of requirements. COMPAS will filter out plugins if their
requirements list is not satisfied at runtime. This allows to have multiple implementations
of the same operation and have them selected based on different criteria.
The requirement can either be a package name string (e.g. <code class="docutils literal notranslate"><span class="pre">requires=['scipy']</span></code>) or
a <code class="docutils literal notranslate"><span class="pre">callable</span></code> with a boolean return value, in which any arbitrary check can be implemented
(e.g. <code class="docutils literal notranslate"><span class="pre">requires=[lambda:</span> <span class="pre">is_rhino_active()]</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tryfirst</span></code> and <code class="docutils literal notranslate"><span class="pre">trylast</span></code>: Plugins cannot control the exact priority they will have
but they can indicate whether to try to prioritize them or demote them as fallback using
these two boolean parameters.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pluggable_name</span></code>: Usually, the name of the decorated plugin method matches that of the
pluggable interface. When that is not the case, the pluggable name can be specified via
this parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">domain</span></code>: extension points are unambiguously identified by a URL that combines domain,
category and pluggable name. All COMPAS core plugins use the same domain, but other
packages could potentially decide to use a different domain to ensure collision-free
naming of pluggable extension points.</p></li>
</ul>
<p>While developing plugins, it is also possible to enable print output to understand what
how plugin selection works behind the scenes. To enable that, set <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> flag
accordingly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">compas.plugins</span> <span class="kn">import</span> <span class="n">plugin_manager</span>
<span class="n">plugin_manager</span><span class="o">.</span><span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">COMPAS</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">Extension points</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="plugins.html" title="previous chapter">Extension points</a></li>
      <li>Next: <a href="changelog.html" title="next chapter">Changelog</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;Block Research Group - ETH Zurich.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>